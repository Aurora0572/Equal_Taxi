# --------------------------------------------------
# Dockerfile   (infra/Dockerfile)
# --------------------------------------------------
FROM python:3.11-slim

WORKDIR /app

# â–¶ ì‹œìŠ¤í…œ íŒ¨í‚¤ì§€ê°€ í•„ìš” ì—†ë‹¤ë©´ build-essential ì‚­ì œí•´ë„ ë©ë‹ˆë‹¤
RUN apt-get update \
    && apt-get install -y --no-install-recommends build-essential \
    && rm -rf /var/lib/apt/lists/*

COPY services/ml-serving/requirements.txt ./
RUN pip install --no-cache-dir --upgrade pip \
    && pip install --no-cache-dir -r requirements.txt

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# â‘  ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œ
COPY services/ml-serving/serving ./serving

# â‘¡ ëª¨ë¸ íŒŒì¼  ğŸ‘‰  **serving/app/model** ë¡œ ë„£ì–´ì¤€ë‹¤ (ğŸ”„ ìˆ˜ì •)
COPY services/ml-serving/app/model ./serving/app/model
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ENV PYTHONUNBUFFERED=1
ENV PYTHONPATH=/app

EXPOSE 8000
CMD ["uvicorn", "serving.api:app", "--host", "0.0.0.0", "--port", "8000"]
